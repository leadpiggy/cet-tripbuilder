{% extends "enrollment/base_wizard.html" %}

{% block step_content %}
<div class="form-section">
    <h3 class="mb-4">
        <i class="bi bi-person"></i> Passenger Information
    </h3>
    
    <p class="text-muted mb-4">
        You must have a valid passport at the time you fill out this information. 
        Please use names as they appear in your passport. 
        Passport needs to be valid for a minimum of 6 months from your travel.
    </p>

    <form method="POST">
        <!-- Legal Name -->
        <div class="row">
            <div class="col-md-4 mb-3">
                <label for="last_name" class="form-label">Last Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="last_name" name="last_name" 
                       value="{{ form.last_name.data or '' }}" required>
            </div>
            <div class="col-md-4 mb-3">
                <label for="first_name" class="form-label">First Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="first_name" name="first_name" 
                       value="{{ form.first_name.data or '' }}" required>
            </div>
            <div class="col-md-4 mb-3">
                <label for="middle_name" class="form-label">Middle Name</label>
                <input type="text" class="form-control" id="middle_name" name="middle_name" 
                       value="{{ form.middle_name.data or '' }}">
            </div>
        </div>

        <!-- Address -->
        <div class="row">
            <div class="col-md-5 mb-3">
                <label for="mailing_address" class="form-label">Mailing Address <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="mailing_address" name="mailing_address" 
                       value="{{ form.mailing_address.data or '' }}" required>
            </div>
            <div class="col-md-3 mb-3">
                <label for="user_city" class="form-label">City <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="user_city" name="user_city" 
                       value="{{ form.user_city.data or '' }}" required>
            </div>
            <div class="col-md-2 mb-3">
                <label for="user_state" class="form-label">State <span class="text-danger">*</span></label>
                {{ form.user_state(class="form-select") }}
            </div>
            <div class="col-md-2 mb-3">
                <label for="user_zip" class="form-label">Zip <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="user_zip" name="user_zip" 
                       value="{{ form.user_zip.data or '' }}" required>
            </div>
        </div>

        <!-- Contact Info -->
        <div class="row">
            <div class="col-md-5 mb-3">
                <label for="user_email" class="form-label">Email Address <span class="text-danger">*</span></label>
                <input type="email" class="form-control" id="user_email" name="user_email" 
                       value="{{ form.user_email.data or '' }}" required>
            </div>
            <div class="col-md-3 mb-3">
                <label for="user_phone" class="form-label">Phone Number</label>
                <input type="tel" class="form-control" id="user_phone" name="user_phone" 
                       value="{{ form.user_phone.data or '' }}">
                <small class="form-text text-muted">Enter phone or mobile</small>
            </div>
            <div class="col-md-4 mb-3">
                <label for="mob_number" class="form-label">Mobile Number</label>
                <input type="tel" class="form-control" id="mob_number" name="mob_number" 
                       value="{{ form.mob_number.data or '' }}">
            </div>
        </div>

        <!-- Room Preferences -->
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="choose_occupancy" class="form-label">Occupancy <span class="text-danger">*</span></label>
                {{ form.choose_occupancy(class="form-select") }}
            </div>
            <div class="col-md-6 mb-3" id="roommate_field" style="display: none;">
                <label for="user_roomate" class="form-label">Roommate Name</label>
                <input type="text" class="form-control" id="user_roomate" name="user_roomate" 
                       value="{{ form.user_roomate.data or '' }}"
                       placeholder="Name of person you'll share a room with">
            </div>
        </div>

        <!-- Birth Country -->
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="birth_country" class="form-label">Country of Birth <span class="text-danger">*</span></label>
                {{ form.birth_country(class="form-select") }}
            </div>
        </div>

        {% if 'Cuba' in form.birth_country.data or False %}
        <div class="alert alert-warning">
            <strong>Special Rules for Cuban-Born Travelers:</strong>
            <p class="mb-0">
                Special rules apply for travelers born in Cuba. Please contact CET sales manager, 
                Vivian Ramos (<a href="mailto:vivian@cubaeducationaltravel.com">vivian@cubaeducationaltravel.com</a>), 
                directly to find out about traveling on a Cuban passport or acquiring a PE-11 passport for Cuban natives.
            </p>
        </div>
        {% endif %}

        <!-- Navigation -->
        <div class="wizard-nav">
            <a href="{{ url_for('enrollment_step', trip_id=trip.id, step=1) }}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back
            </a>
            <button type="submit" class="btn btn-primary">
                Next: Passport Info <i class="bi bi-arrow-right"></i>
            </button>
        </div>
    </form>
</div>

<script>
// Show/hide roommate field based on occupancy selection
document.getElementById('choose_occupancy').addEventListener('change', function() {
    const roommateField = document.getElementById('roommate_field');
    if (this.value === 'double') {
        roommateField.style.display = 'block';
    } else {
        roommateField.style.display = 'none';
        document.getElementById('user_roomate').value = '';
    }
});

// Check on page load
if (document.getElementById('choose_occupancy').value === 'double') {
    document.getElementById('roommate_field').style.display = 'block';
}
</script>
{% endblock %}